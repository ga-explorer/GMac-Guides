<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<base href="https://gmac-guides.netlify.com" />

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="profile" href="http://gmpg.org/xfn/11">
  <link rel="pingback" href="https://gmac-guides.netlify.com/xmlrpc.php">

  <title>GMacDSL Affine Geometry Sample - GMac Guides</title>
<script>document.documentElement.className = document.documentElement.className.replace("no-js","js");</script>

<!-- This site is optimized with the Yoast SEO plugin v5.6.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="The samples described here, illustrate using GMacDSL for encoding 3D affine geometry primitives and transformations using 3D Euclidean Geometric Algebra"/>
<link rel="canonical" href="https://gmac-guides.netlify.com/index.php/gmacdsl-affine-geometry-sample/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="GMacDSL Affine Geometry Sample - GMac Guides" />
<meta property="og:description" content="The samples described here, illustrate using GMacDSL for encoding 3D affine geometry primitives and transformations using 3D Euclidean Geometric Algebra" />
<meta property="og:url" content="https://gmac-guides.netlify.com/index.php/gmacdsl-affine-geometry-sample/" />
<meta property="og:site_name" content="GMac Guides" />
<meta property="og:image" content="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/Fractal_fern_explained.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="The samples described here, illustrate using GMacDSL for encoding 3D affine geometry primitives and transformations using 3D Euclidean Geometric Algebra" />
<meta name="twitter:title" content="GMacDSL Affine Geometry Sample - GMac Guides" />
<meta name="twitter:image" content="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/Fractal_fern_explained.png" />
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"http:\/\/gmac-guides.netlify.com\/","name":"GMac Guides","potentialAction":{"@type":"SearchAction","target":"http:\/\/gmac-guides.netlify.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="GMac Guides &raquo; Feed" href="https://gmac-guides.netlify.com/index.php/feed/" />
<link rel="alternate" type="application/rss+xml" title="GMac Guides &raquo; Comments Feed" href="https://gmac-guides.netlify.com/index.php/comments/feed/" />
<link id="hu-user-gfont" href="//fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700" rel="stylesheet" type="text/css">		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/gmac-guides.netlify.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='papercite_css-css'  href='https://gmac-guides.netlify.com/wp-content/plugins/papercite/papercite.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-css'  href='https://gmac-guides.netlify.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-github-css'  href='https://gmac-guides.netlify.com/wp-content/plugins/crayon-syntax-highlighter/themes/github/github.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://gmac-guides.netlify.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='cpsh-shortcodes-css'  href='https://gmac-guides.netlify.com/wp-content/plugins/column-shortcodes//assets/css/shortcodes.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='dlm-frontend-css'  href='https://gmac-guides.netlify.com/wp-content/plugins/download-monitor/assets/css/frontend.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='megamenu-css'  href='https://gmac-guides.netlify.com/wp-content/uploads/maxmegamenu/style.css?ver=62534a' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://gmac-guides.netlify.com/wp-includes/css/dashicons.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='hueman-main-style-css'  href='https://gmac-guides.netlify.com/wp-content/themes/hueman/assets/front/css/main.min.css?ver=3.3.22' type='text/css' media='all' />
<style id='hueman-main-style-inline-css' type='text/css'>
body { font-family:'Droid Serif', serif;font-size:1.00rem }@media only screen and (min-width: 720px) {
        .nav > li { font-size:1.00rem; }
      }.sidebar .widget { padding-left: 20px; padding-right: 20px; padding-top: 20px; }.is-scrolled #header #nav-mobile { background-color: #454e5c; background-color: rgba(69,78,92,0.90) }.site-title a img { max-height: 280px; }body { background-color: #eaeaea; }
</style>
<link rel='stylesheet' id='hueman-font-awesome-css'  href='https://gmac-guides.netlify.com/wp-content/themes/hueman/assets/front/css/font-awesome.min.css?ver=3.3.22' type='text/css' media='all' />
<!--n2css--><script type='text/javascript' src='https://gmac-guides.netlify.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-content/plugins/papercite/js/papercite.js?ver=4.8.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/gmac-guides.netlify.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<link rel='https://api.w.org/' href='https://gmac-guides.netlify.com/index.php/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://gmac-guides.netlify.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://gmac-guides.netlify.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.2" />
<link rel='shortlink' href='https://gmac-guides.netlify.com/?p=2078' />
<link rel="alternate" type="application/json+oembed" href="https://gmac-guides.netlify.com/index.php/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fgmac-guides.netlify.com%2Findex.php%2Fgmacdsl-affine-geometry-sample%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://gmac-guides.netlify.com/index.php/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fgmac-guides.netlify.com%2Findex.php%2Fgmacdsl-affine-geometry-sample%2F&#038;format=xml" />
            <script type="text/javascript" id="ha-customize-btn">
              jQuery( function($) {
                  $( "#wp-admin-bar-customize").find('a').attr('title', 'Customize this page !' );
              });
            </script>
            <style type="text/css" id="ha-fun-ab">
              @-webkit-keyframes super-rainbow {
                0%   { text-shadow : 0px 0px 2px;}
                20%  { text-shadow : 0px 0px 5px; }
                40%  { text-shadow : 0px 0px 10px; }
                60%  { text-shadow : 0px 0px 13px }
                80%  { text-shadow : 0px 0px 10px; }
                100% { text-shadow : 0px 0px 5px; }
              }
              @-moz-keyframes super-rainbow {
                0%   { text-shadow : 0px 0px 2px;}
                20%  { text-shadow : 0px 0px 5px; }
                40%  { text-shadow : 0px 0px 10px; }
                60%  { text-shadow : 0px 0px 13px }
                80%  { text-shadow : 0px 0px 10px; }
                100% { text-shadow : 0px 0px 5px; }
              }

              #wp-admin-bar-customize .ab-item:before {
                  color:#7ECEFD;
                  -webkit-animation: super-rainbow 4s infinite linear;
                   -moz-animation: super-rainbow 4s infinite linear;
              }
            </style>
        <!--[if lt IE 9]>
<script src="https://gmac-guides.netlify.com/wp-content/themes/hueman/assets/front/js/ie/html5shiv-printshiv.min.js"></script>
<script src="https://gmac-guides.netlify.com/wp-content/themes/hueman/assets/front/js/ie/selectivizr.js"></script>
<![endif]-->
<style type="text/css">.broken_link, a.broken_link {
	text-decoration: line-through;
}</style><link rel="icon" href="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/cropped-GAExplorer-Icon-150x150.jpg" sizes="32x32" />
<link rel="icon" href="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/cropped-GAExplorer-Icon-300x300.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/cropped-GAExplorer-Icon-300x300.jpg" />
<meta name="msapplication-TileImage" content="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/cropped-GAExplorer-Icon-300x300.jpg" />
<style type="text/css">/** Mega Menu CSS Disabled **/</style>
<style type="text/css"> #turnkey-credit { font-family: Tahoma,Sans,Arial,Helvetica,Verdana,sans-serif; font-size: 11px; text-align: center; } #turnkey-credit a { text-decoration: none; } #turnkey-credit a:hover { text-decoration: underline; } body.wp-admin #turnkey-credit, body#image #turnkey-credit, body#media-upload #turnkey-credit { display: none; } </style></head>

<body class="page-template-default page page-id-2078 mega-menu-header col-1c full-width mobile-sidebar-hide header-desktop-sticky header-mobile-sticky unknown">

<div id="wrapper">

  
  <header id="header" class="top-menu-mobile-on one-mobile-menu top_menu header-ads-desktop  topbar-transparent has-header-img">
        <nav class="nav-container group mobile-menu mobile-sticky no-menu-assigned" id="nav-mobile" data-menu-id="header-1">
  <div class="mobile-title-logo-in-header"></div>
        
                    <!-- <div class="ham__navbar-toggler collapsed" aria-expanded="false">
          <div class="ham__navbar-span-wrapper">
            <span class="ham-toggler-menu__span"></span>
          </div>
        </div> -->
        <div class="ham__navbar-toggler-two collapsed" title="Menu" aria-expanded="false">
          <div class="ham__navbar-span-wrapper">
            <span class="line line-1"></span>
            <span class="line line-2"></span>
            <span class="line line-3"></span>
          </div>
        </div>
            
      <div class="nav-text"></div>
      <div class="nav-wrap container">
                  <ul class="nav container-inner group mobile-search">
                            <li>
                  <form method="get" class="searchform themeform" action="https://gmac-guides.netlify.com/">
	<div>
		<input type="text" class="search" name="s" onblur="if(this.value=='')this.value='To search type and hit enter';" onfocus="if(this.value=='To search type and hit enter')this.value='';" value="To search type and hit enter" />
	</div>
</form>                </li>
                      </ul>
                <div id="mega-menu-wrap-header" class="mega-menu-wrap"><div class="mega-menu-toggle" tabindex="0"><div class='mega-toggle-block mega-menu-toggle-block mega-toggle-block-right mega-toggle-block-1' id='mega-toggle-block-1'></div></div><ul id="mega-menu-header" class="mega-menu mega-menu-horizontal mega-no-js" data-event="hover_intent" data-effect="fade" data-effect-speed="400" data-second-click="close" data-document-click="collapse" data-vertical-behaviour="accordion" data-breakpoint="600" data-unbind="true"><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-home mega-align-bottom-left mega-menu-flyout mega-menu-item-2838' id='mega-menu-item-2838'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/" tabindex="0">Home</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-2841' id='mega-menu-item-2841'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/about-gmac/" tabindex="0">About GMac</a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-2836' id='mega-menu-item-2836'><a class="mega-menu-link" href="#" aria-haspopup="true" tabindex="0">GMac Guides</a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2852' id='mega-menu-item-2852'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-system-guide/">GMac System Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2842' id='mega-menu-item-2842'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-math-guide/">GMac Math Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2847' id='mega-menu-item-2847'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmacdsl-guide/">GMacDSL Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2849' id='mega-menu-item-2849'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmacast-guide/">GMacAST Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2848' id='mega-menu-item-2848'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/textcomposerlib-guide/">TextComposerLib Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2850' id='mega-menu-item-2850'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmacapi-guide/">GMacAPI Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2851' id='mega-menu-item-2851'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-scripting-guide/">GMac Scripting Guide</a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-2853' id='mega-menu-item-2853'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-samples/" tabindex="0">GMac Samples</a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-2834' id='mega-menu-item-2834'><a class="mega-menu-link" href="#" aria-haspopup="true" tabindex="0">Galleries</a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2845' id='mega-menu-item-2845'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/islamic-calligraphy/">Islamic Calligraphy</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2854' id='mega-menu-item-2854'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-logos/">GMac Logos</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2855' id='mega-menu-item-2855'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/textcomposerlib-logos/">TextComposerLib Logos</a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-2839' id='mega-menu-item-2839'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/contact/" tabindex="0">Contact</a></li></ul></div>      </div>
</nav><!--/#nav-topbar-->  
  
  <div class="container group">
        <div class="container-inner">

                <div id="header-image-wrap">
              <div class="group pad central-header-zone">
                                                  </div>

              <a href="https://gmac-guides.netlify.com/" rel="home"><img class="site-image" src="https://gmac-guides.netlify.com/wp-content/uploads/2017/10/GMac-Logo-v1.jpg" alt="GMac Guides"></a>          </div>
      
                <nav class="nav-container group desktop-menu " id="nav-header" data-menu-id="header-2">
    <div class="nav-text"><!-- put your mobile menu text here --></div>

  <div class="nav-wrap container">
        <div id="mega-menu-wrap-header" class="mega-menu-wrap"><div class="mega-menu-toggle" tabindex="0"><div class='mega-toggle-block mega-menu-toggle-block mega-toggle-block-right mega-toggle-block-1' id='mega-toggle-block-1'></div></div><ul id="mega-menu-header" class="mega-menu mega-menu-horizontal mega-no-js" data-event="hover_intent" data-effect="fade" data-effect-speed="400" data-second-click="close" data-document-click="collapse" data-vertical-behaviour="accordion" data-breakpoint="600" data-unbind="true"><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-home mega-align-bottom-left mega-menu-flyout mega-menu-item-2838' id='mega-menu-item-2838'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/" tabindex="0">Home</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-2841' id='mega-menu-item-2841'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/about-gmac/" tabindex="0">About GMac</a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-2836' id='mega-menu-item-2836'><a class="mega-menu-link" href="#" aria-haspopup="true" tabindex="0">GMac Guides</a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2852' id='mega-menu-item-2852'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-system-guide/">GMac System Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2842' id='mega-menu-item-2842'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-math-guide/">GMac Math Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2847' id='mega-menu-item-2847'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmacdsl-guide/">GMacDSL Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2849' id='mega-menu-item-2849'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmacast-guide/">GMacAST Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2848' id='mega-menu-item-2848'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/textcomposerlib-guide/">TextComposerLib Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2850' id='mega-menu-item-2850'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmacapi-guide/">GMacAPI Guide</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2851' id='mega-menu-item-2851'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-scripting-guide/">GMac Scripting Guide</a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-2853' id='mega-menu-item-2853'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-samples/" tabindex="0">GMac Samples</a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-2834' id='mega-menu-item-2834'><a class="mega-menu-link" href="#" aria-haspopup="true" tabindex="0">Galleries</a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2845' id='mega-menu-item-2845'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/islamic-calligraphy/">Islamic Calligraphy</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2854' id='mega-menu-item-2854'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/gmac-logos/">GMac Logos</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-2855' id='mega-menu-item-2855'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/textcomposerlib-logos/">TextComposerLib Logos</a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-2839' id='mega-menu-item-2839'><a class="mega-menu-link" href="https://gmac-guides.netlify.com/index.php/contact/" tabindex="0">Contact</a></li></ul></div>  </div>
</nav><!--/#nav-header-->      
    </div><!--/.container-inner-->
      </div><!--/.container-->

</header><!--/#header-->
  
  <div class="container" id="page">
    <div class="container-inner">
            <div class="main">
        <div class="main-inner group">
          
              <section class="content">
              <div class="page-title pad group">
          	    		<h1>GMacDSL Affine Geometry Sample</h1>
    	
    </div><!--/.page-title-->
          <div class="pad group">
            
  <article class="group post-2078 page type-page status-publish hentry">

    
    <div class="entry themeform">
      <p><a href="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/Fractal_fern_explained.png"><img class="alignright wp-image-2085 size-full" src="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/Fractal_fern_explained.png" alt="Affine Geometry Fractal" width="333" height="465" srcset="https://gmac-guides.netlify.com/wp-content/uploads/2016/12/Fractal_fern_explained.png 333w, https://gmac-guides.netlify.com/wp-content/uploads/2016/12/Fractal_fern_explained-215x300.png 215w" sizes="(max-width: 333px) 100vw, 333px" /></a><a href="https://en.wikipedia.org/wiki/Affine_geometry">Affine Geometry</a> is one of the common mathematical representations used in many geometric modeling applications in computer science and engineering. The two most important primitive geometric concepts of Affine Geometry are points and directions. In classical representations, both are encoded using coordinate vectors having two meanings but similar numerical forms: the position vectors for points, and the free vectors for directions. <a href="https://en.wikipedia.org/wiki/Affine_transformation">Affine Transformations</a> can be defined on positions and directions to produce other positions and directions. The two primitives and their affine transformations construct a full <a href="https://en.wikipedia.org/wiki/Affine_space">Affine Space</a> useful for many practical applications.</p>
<p>The samples described on this page illustrate how to use GMacDSL for encoding 3D affine primitives and transformations using the simplest of all geometric algebras: the 3D Euclidean GA having 8-dimenstional multivectors. The equations used here are based on <a href="https://www.cs.rice.edu/~rng/">Ronald Goldman</a>&#8216;s nice book: &#8220;<a href="https://www.crcpress.com/An-Integrated-Introduction-to-Computer-Graphics-and-Geometric-Modeling/Goldman/p/book/9781439803349">An Integrated Introduction to Computer Graphics and Geometric Modeling</a>&#8220;. I really enjoyed teaching a post-graduate Geometric Modeling course based on this book. We will explore using GMacDSL for this task, and see how the selection of our algebra can seriously limit our ability to write geometric computing code regardless of the selected programming language.</p>
<h3>Affine Transformations on Points and Vectors</h3>
<p>The following GMacDSL code can be compiled in all <a href="https://gmac-guides.netlify.com/index.php/about-gmac/">3 editions of GMac</a>. The code contains several macros defined on the 3D Euclidean Geometric Algebra. The macros define some affine transforms on points (positions) and vectors (directions). 3D Euclidean GA is not the best GA space for compactly representing affine geometry. Algebraically, the best space for representing any geometry is a space where GA blades represent the main geometric primitives, and the geometric transformations are fully represented as orthogonal transforms using GA versors. The second best thing is to use outermorphisms to represent the main geometric transformations. Nevertheless, the Euclidean GA is conceptually simple to understand for anyone starting to learn to model with geometric algebra. In addition, learning GMacDSL is easier when coding with a familiar GA space.</p>
<p style="text-align: center;"><strong>Code Listing 1</strong></p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-59e4fc22a4b0f748063570" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C#</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//The main namespace of this project
namespace affine3d

//Define the 3D Euclidean GA frame
frame e3d (e1, e2, e3) euclidean

//The inverse pseudo-scalar of the 3D Euclidean space
constant e3d.Iinv = reverse(I) / norm2(I)

//This macro finds the unit vector of the given direction vector
macro e3d.UnitVector(v : Multivector) : Multivector
begin
    return v / 'Sqrt[$norm2(v)$]'
end

//This macro finds the cross product of two vectors u and v
macro e3d.CrossProduct(u : Multivector, v : Multivector) : Multivector
begin
    return (u op v) lcp Iinv
end

//This macro finds the unit normal to two vectors
macro e3d.UnitCrossProduct(u : Multivector, v : Multivector) : Multivector
begin
    return UnitVector((u op v) lcp Iinv)
end

//This macro finds the inverse of the given blade B
macro e3d.BladeInverse(B : Multivector) : Multivector
begin
    return reverse(B) / norm2(B)
end

//This macro finds the dual of a given blade B
macro e3d.BladeDual(B : Multivector) : Multivector
begin
    return B lcp Iinv
end

//This macro find the projection of a vector v on a blade B
macro e3d.ProjectVector(v : Multivector, B : Multivector) : Multivector
begin
    //The inverse of B
    let Bi = reverse(B) / norm2(B)
    
    //The final result
    return (v lcp B) gp Bi
end

//This macro find the rejection (v minus its projection) of a vector v on a blade B
macro e3d.RejectVector(v : Multivector, B : Multivector) : Multivector
begin
    //The inverse of B
    let Bi = reverse(B) / norm2(B)
    
    //The final result
    return (v op B) gp Bi
end

//This macro projects the given vector v on the unit vector u
macro e3d.ProjectVectorOnUnitVector(v : Multivector, u : Multivector) : Multivector
begin
    return (v lcp u) gp u
end

//This macro rejects the given vector v on the unit vector u
macro e3d.RejectVectorOnUnitVector(v : Multivector, u : Multivector) : Multivector
begin
    return (v op u) gp u
end

//This macro translates the given point p in the direction of vector v
macro e3d.TranslatePoint(p : Multivector, v : Multivector) : Multivector
begin
    return p + v
end

//This macro rotates the vector v around a direction unit vector u with an angle a in radians
macro e3d.AxisRotateVector(v : Multivector, u : Multivector, a : scalar) : Multivector
begin
    //Using the formula of Rodrigues
/*
    let ca = 'Cos[$a$]' //Cos of angle
    let sa = 'Sin[$a$]' //Sin of angle
    
    return ca * v + (1 - ca) * (v lcp u) gp u + sa * CrossProduct(u, v)
*/

    //Using the much simpler and more general GA Rotor
    let cha = 'Cos[$a$ / 2]' //Cos of half-angle
    let sha = 'Sin[$a$ / 2]' //Sin of half-angle
    
    return cha - sha * BladeDual(u)
end

//This macro rotates the point p around an axis passing through point q and having 
//direction unit vector u with an angle a in radians
macro e3d.AxisRotatePoint(p : Multivector, q : Multivector, u : Multivector, a : scalar) : Multivector
begin
    return AxisRotateVector(p - q, u, a) + q
end

//This macro reflects a direction vector v into a plane with unit normal n and passing through 
//an arbitrary point
macro e3d.ReflectVector(v : Multivector, n : Multivector) : Multivector
begin
    //Using classical formula
    //return v - 2(v lcp n) gp n
    
    //Using the more general GA formula of reflection in unit vector n dually 
    //representing the plane of reflection
    return -n gp v gp n
end

//This macro reflects a point p into a plane with unit normal n and passing through 
//the point q
macro e3d.ReflectPoint(p : Multivector, q : Multivector, n : Multivector) : Multivector
begin
    return ReflectVector(p - q, n) + q
end

//This macro performs a uniform scaling of the given vector v by a factor s
macro e3d.UniformlyScaleVector(v : Multivector, s : scalar) : Multivector
begin
    return s * v
end

//This macro performs a uniform scaling of the given point p by a factor s relative to point q
macro e3d.UniformlyScalePoint(p : Multivector, q : Multivector, s : scalar) : Multivector
begin
    return UniformlyScaleVector(p - q, s) + q
end

//This macro performs a directional scaling of the given vector v by factor s in the direction 
//of the unit vector u
macro e3d.ScaleVector(v : Multivector, u : Multivector, s : scalar) : Multivector
begin
    //This formula is the classical formula given in the book
    //return v + (s - 1) * (v lcp u) gp u
    
    //This formula is a direct application of the geometric process of this transformation
    return RejectVectorOnUnitVector(v, u) + s * ProjectVectorOnUnitVector(v, u)
end

//This macro performs a directional scaling of the given point p by factor s in the direction 
//of the unit vector u and relative to the point q
macro e3d.ScalePoint(p : Multivector, q : Multivector, u : Multivector, s : scalar) : Multivector
begin
    return ScaleVector(p - q, u, s) + q
end</textarea></div>
			<div class="crayon-main" style=" max-height: 500px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-2">2</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-4">4</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-6">6</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-8">8</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-10">10</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-12">12</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-14">14</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-16">16</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-18">18</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-20">20</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-22">22</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-24">24</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-26">26</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-28">28</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-30">30</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-32">32</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-34">34</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-36">36</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-38">38</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-40">40</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-42">42</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-44">44</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-46">46</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-48">48</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-50">50</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-52">52</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-54">54</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-56">56</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-58">58</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-60">60</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-62">62</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-64">64</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-66">66</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-68">68</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-70">70</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-72">72</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-74">74</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-76">76</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-78">78</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-80">80</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-82">82</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-84">84</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-86">86</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-88">88</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-90">90</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-92">92</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-94">94</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-96">96</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-98">98</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-100">100</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-102">102</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-104">104</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-106">106</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-108">108</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-110">110</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-112">112</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-114">114</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-116">116</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-118">118</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-120">120</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-122">122</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-124">124</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-126">126</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-128">128</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-130">130</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-132">132</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-134">134</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-136">136</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-138">138</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-140">140</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-142">142</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-144">144</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-146">146</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-148">148</div><div class="crayon-num" data-line="crayon-59e4fc22a4b0f748063570-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b0f748063570-150">150</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-1"><span class="crayon-c">//The main namespace of this project</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-2"><span class="crayon-t">namespace</span><span class="crayon-h"> </span><span class="crayon-v">affine3d</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-4"><span class="crayon-c">//Define the 3D Euclidean GA frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-5"><span class="crayon-e">frame </span><span class="crayon-e">e3d</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e3</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">euclidean</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-6">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-7"><span class="crayon-c">//The inverse pseudo-scalar of the 3D Euclidean space</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-8"><span class="crayon-e">constant </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-v">Iinv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-v">I</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-e">norm2</span><span class="crayon-sy">(</span><span class="crayon-v">I</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-10"><span class="crayon-c">//This macro finds the unit vector of the given direction vector</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-11"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UnitVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-12"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-13"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-s">'Sqrt[$norm2(v)$]'</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-14"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-16"><span class="crayon-c">//This macro finds the cross product of two vectors u and v</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-17"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">CrossProduct</span><span class="crayon-sy">(</span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-18"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-19"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">u</span><span class="crayon-h"> </span><span class="crayon-i">op</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">lcp </span><span class="crayon-e">Iinv</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-20"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-22"><span class="crayon-c">//This macro finds the unit normal to two vectors</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-23"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UnitCrossProduct</span><span class="crayon-sy">(</span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-24"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-25"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">UnitVector</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-i">u</span><span class="crayon-h"> </span><span class="crayon-i">op</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">lcp </span><span class="crayon-v">Iinv</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-26"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-28"><span class="crayon-c">//This macro finds the inverse of the given blade B</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-29"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">BladeInverse</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-30"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-31"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-e">norm2</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-32"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-34"><span class="crayon-c">//This macro finds the dual of a given blade B</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-35"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">BladeDual</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-36"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-37"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-i">B</span><span class="crayon-h"> </span><span class="crayon-e">lcp </span><span class="crayon-e">Iinv</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-38"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-40"><span class="crayon-c">//This macro find the projection of a vector v on a blade B</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-41"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ProjectVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-42"><span class="crayon-v">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//The inverse of B</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">Bi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-e">norm2</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//The final result</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">v</span><span class="crayon-h"> </span><span class="crayon-i">lcp</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">gp </span><span class="crayon-e">Bi</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-48"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-50"><span class="crayon-c">//This macro find the rejection (v minus its projection) of a vector v on a blade B</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-51"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">RejectVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-52"><span class="crayon-v">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//The inverse of B</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">Bi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-e">norm2</span><span class="crayon-sy">(</span><span class="crayon-v">B</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//The final result</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">v</span><span class="crayon-h"> </span><span class="crayon-i">op</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">gp </span><span class="crayon-e">Bi</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-58"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-60"><span class="crayon-c">//This macro projects the given vector v on the unit vector u</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-61"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ProjectVectorOnUnitVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-62"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-63"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">v</span><span class="crayon-h"> </span><span class="crayon-i">lcp</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">gp</span><span class="crayon-h"> </span><span class="crayon-i">u</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-64"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-65">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-66"><span class="crayon-c">//This macro rejects the given vector v on the unit vector u</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-67"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">RejectVectorOnUnitVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-68"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-69"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">v</span><span class="crayon-h"> </span><span class="crayon-i">op</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">gp</span><span class="crayon-h"> </span><span class="crayon-i">u</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-70"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-72"><span class="crayon-c">//This macro translates the given point p in the direction of vector v</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-73"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-74"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-75"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">v</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-76"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-77">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-78"><span class="crayon-c">//This macro rotates the vector v around a direction unit vector u with an angle a in radians</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-79"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-80"><span class="crayon-v">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Using the formula of Rodrigues</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-82"><span class="crayon-c">/*</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-83"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;let ca = 'Cos[$a$]' //Cos of angle</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-84"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;let sa = 'Sin[$a$]' //Sin of angle</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-85"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-86"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;return ca * v + (1 - ca) * (v lcp u) gp u + sa * CrossProduct(u, v)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-87"><span class="crayon-c">*/</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-88">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Using the much simpler and more general GA Rotor</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">cha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Cos[$a$ / 2]'</span><span class="crayon-h"> </span><span class="crayon-c">//Cos of half-angle</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">sha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Sin[$a$ / 2]'</span><span class="crayon-h"> </span><span class="crayon-c">//Sin of half-angle</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">cha</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">sha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">BladeDual</span><span class="crayon-sy">(</span><span class="crayon-v">u</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-94"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-95">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-96"><span class="crayon-c">//This macro rotates the point p around an axis passing through point q and having </span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-97"><span class="crayon-c">//direction unit vector u with an angle a in radians</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-98"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-99"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-100"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-101"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-102">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-103"><span class="crayon-c">//This macro reflects a direction vector v into a plane with unit normal n and passing through </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-104"><span class="crayon-c">//an arbitrary point</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-105"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-106"><span class="crayon-v">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Using classical formula</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//return v - 2(v lcp n) gp n</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Using the more general GA formula of reflection in unit vector n dually </span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//representing the plane of reflection</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-i">gp</span><span class="crayon-h"> </span><span class="crayon-i">v</span><span class="crayon-h"> </span><span class="crayon-i">gp</span><span class="crayon-h"> </span><span class="crayon-i">n</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-113"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-114">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-115"><span class="crayon-c">//This macro reflects a point p into a plane with unit normal n and passing through </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-116"><span class="crayon-c">//the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-117"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-118"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-119"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-120"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-121">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-122"><span class="crayon-c">//This macro performs a uniform scaling of the given vector v by a factor s</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-123"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-124"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-125"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-i">v</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-126"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-127">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-128"><span class="crayon-c">//This macro performs a uniform scaling of the given point p by a factor s relative to point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-129"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-130"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-131"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-132"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-133">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-134"><span class="crayon-c">//This macro performs a directional scaling of the given vector v by factor s in the direction </span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-135"><span class="crayon-c">//of the unit vector u</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-136"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-137"><span class="crayon-v">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-138"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//This formula is the classical formula given in the book</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-139"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//return v + (s - 1) * (v lcp u) gp u</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-140"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-141"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//This formula is a direct application of the geometric process of this transformation</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-142"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">RejectVectorOnUnitVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">ProjectVectorOnUnitVector</span><span class="crayon-sy">(</span><span class="crayon-v">v</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-143"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-144">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-145"><span class="crayon-c">//This macro performs a directional scaling of the given point p by factor s in the direction </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-146"><span class="crayon-c">//of the unit vector u and relative to the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-147"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Multivector</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-148"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b0f748063570-149"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">ScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b0f748063570-150"><span class="crayon-v">end</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0188 seconds] -->
<p></p>
<h3>Adding Combinatorial Geometric Objects</h3>
<p>Points and vectors are just a base for making more complex geometric objects in affine geometry. 3D Frames, Lines, and planes can&#8217;t be represented by a single coordinate vector in 3D Euclidean space. All points on a line can be generated by defining two points, or a point and a vector. All points on a plane can be defined using a point and a normal, 3 non-colinear points, or a point and two non-parallel vectors. Consequently, no single multivector in our simple GA can represent a general line or plane. We can use GMacDSL structures for this task. Using structures require the <em><strong>GMac Basic</strong></em> or <em><strong>GMac Complete</strong></em> Editions. The following code can be added to the previous code to implement transformations on frames, lines, and planes in affine space:</p>
<p style="text-align: center;"><strong>Code Listing 2</strong></p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-59e4fc22a4b1f367987421" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C#</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//Our main namespace
namespace affine3d

//A frame in 3D consisting of an origin point and 3 linearly independent vectors. 
//A frame with orthonormal vectors is the main model for a rigid body in many applications
structure e3d.Frame (O : Multivector, X : Multivector, Y : Multivector, Z : Multivector)

//1st Problem: The same geometric concept (line or plane) have many combinatorial representations.
//Each representation is suitable for a subset of our geometric manipulation algorithms.
//For each representation we store the generators of the concept (usually simpler geometric concepts)
//such that we can construct the geometric concept from these generators using simple algebraic manipulation

//A line generated by two points
structure e3d.LinePP (P1 : Multivector, P2 : Multivector)

//A line generated by a point and a vector
structure e3d.LinePV (P : Multivector, V : Multivector)

//A plane generated by 3 points
structure e3d.PlanePPP (P1 : Multivector, P2 : Multivector, P3 : Multivector)

//A plane generated by a point and a unit-normal
structure e3d.PlanePN (P : Multivector, N : Multivector)

//This macro adjusts the given frame to make sure its 3 vectors are orthonormal and right-handed
macro e3d.NormalizeFrame(F : Frame) : Frame
begin
    declare st : Frame
    let st.O = F.O
    let st.X = UnitVector(F.X)
    let st.Y = UnitVector(RejectVector(F.Y, st.X))
    let st.Z = CrossProduct(st.X, st.Y)
    return st
end

//2nd Problem: We need to convert between different representations of the same geometric concept.
//his is becaus each representation is only suitable for a subset of all geometric operations 
//on the geometric concept. We usually apply several algorithms together so we need this intermediate 
//conversion of representation often

//3rd Problem: Are there any other geometric operations that can be used to represent the same
//geometric concept? (A line can be geometrically represented by two planes as their intersection)
//How can we enumerate all possible combinatorial represenatations?

//Convert a line in two-points form into the point-vector form
macro e3d.LinePP2LinePV(L : LinePP) : LinePV
begin
    return LinePV(P = L.P1, V = L.P2 - L.P1)
end

//Convert a line in point-vector form into the two-points form
macro e3d.LinePV2LinePP(L : LinePV) : LinePP
begin
    return LinePP(P1 = L.P, P2 = L.P + L.V)
end

//Convert a plane in 3-points form into the point-normal form
macro e3d.PlanePPP2PlanePN(P : PlanePPP) : PlanePN
begin
    return PlanePN(P = P.P1, N = UnitCrossProduct(P.P2 - P.P1, P.P3 - P.P1))
end

//Convert a plane in point-normal form into the 3-points form
macro e3d.PlanePN2PlanePPP(P : PlanePN) : PlanePPP
begin
    //Assuming normal to plane P is almost parallel to z-axis; this is not numerically
    //stable if angle between plane normal and z-axis is near 90 degrees
    let u = CrossProduct(Multivector(#e3# = 1), P.N)
    let v = CrossProduct(P.N, u)
    
    return PlanePPP(P1 = P.P, P2 = P.P + u, P3 = P.P + v)
end

//4th Problem: Transforming geometric concepts must be specialized to each combinatorial representation

//Translate a frame F in the direction of vector v
macro e3d.TranslateFrame(F : Frame, v : Multivector) : Frame
begin
    declare st : Frame
    let st.O = TranslatePoint(F.O, v)
    let st.X = F.X
    let st.Y = F.Y
    let st.Z = F.Z
    return st
end

//Translate a line L in the direction of vector v
macro e3d.TranslateLinePP(L : LinePP, v : Multivector) : LinePP
begin
    declare st : LinePP
    let st.P1 = TranslatePoint(L.P1, v)
    let st.P2 = TranslatePoint(L.P2, v)
    return st
end

//Translate a line L in the direction of vector v
macro e3d.TranslateLinePV(L : LinePV, v : Multivector) : LinePV
begin
    declare st : LinePV
    let st.P = TranslatePoint(L.P, v)
    let st.V = L.V
    return st
end

//Translate a plane P in the direction of vector v
macro e3d.TranslatePlanePPP(P : PlanePPP, v : Multivector) : PlanePPP
begin
    declare st : PlanePPP
    let st.P1 = TranslatePoint(P.P1, v)
    let st.P2 = TranslatePoint(P.P2, v)
    let st.P3 = TranslatePoint(P.P3, v)
    return st
end

//Translate a plane P in the direction of vector v
macro e3d.TranslatePlanePN(P : PlanePN, v : Multivector) : PlanePN
begin
    declare st : PlanePN
    let st.P = TranslatePoint(P.P, v)
    let st.N = P.N
    return st
end

//Rotate the frame F around an axis passing through point q and having 
//direction unit vector u with an angle a in radians
macro e3d.AxisRotateFrame(F : Frame, q : Multivector, u : Multivector, a : scalar) : Frame
begin
    declare st : Frame
    let st.O = AxisRotatePoint(F.O, q, u, a)
    let st.X = AxisRotateVector(F.X, u, a)
    let st.Y = AxisRotateVector(F.Y, u, a)
    let st.Z = AxisRotateVector(F.Z, u, a)
    return st
end

//Rotate the line L around an axis passing through point q and having 
//direction unit vector u with an angle a in radians
macro e3d.AxisRotateLinePP(L : LinePP, q : Multivector, u : Multivector, a : scalar) : LinePP
begin
    declare st : LinePP
    let st.P1 = AxisRotatePoint(L.P1, q, u, a)
    let st.P2 = AxisRotatePoint(L.P2, q, u, a)
    return st
end

//Rotate the line L around an axis passing through point q and having 
//direction unit vector u with an angle a in radians
macro e3d.AxisRotateLinePV(L : LinePV, q : Multivector, u : Multivector, a : scalar) : LinePV
begin
    declare st : LinePV
    let st.P = AxisRotatePoint(L.P, q, u, a)
    let st.V = AxisRotateVector(L.V, u, a)
    return st
end

//Rotate the plane P around an axis passing through point q and having 
//direction unit vector u with an angle a in radians
macro e3d.AxisRotatePlanePPP(P : PlanePPP, q : Multivector, u : Multivector, a : scalar) : PlanePPP
begin
    declare st : PlanePPP
    let st.P1 = AxisRotatePoint(P.P1, q, u, a)
    let st.P2 = AxisRotatePoint(P.P2, q, u, a)
    let st.P3 = AxisRotatePoint(P.P3, q, u, a)
    return st
end

//Rotate the plane P around an axis passing through point q and having 
//direction unit vector u with an angle a in radians
macro e3d.AxisRotatePlanePN(P : PlanePN, q : Multivector, u : Multivector, a : scalar) : PlanePN
begin
    declare st : PlanePN
    let st.P = AxisRotatePoint(P.P, q, u, a)
    let st.N = AxisRotateVector(P.N, u, a)
    return st
end

//Reflect a frame F into a plane with unit normal n and passing through 
//the point q
macro e3d.ReflectFrame(F : Frame, q : Multivector, n : Multivector) : Frame
begin
    declare st : Frame
    let st.O = ReflectPoint(F.O, q, n)
    let st.X = ReflectVector(F.X, n)
    let st.Y = ReflectVector(F.Y, n)
    let st.Z = ReflectVector(F.Z, n)
    return st
end

//Reflect a line L into a plane with unit normal n and passing through 
//the point q
macro e3d.ReflectLinePP(L : LinePP, q : Multivector, n : Multivector) : LinePP
begin
    declare st : LinePP
    let st.P1 = ReflectPoint(L.P1, q, n)
    let st.P2 = ReflectPoint(L.P2, q, n)
    return st
end

//Reflect a line L into a plane with unit normal n and passing through 
//the point q
macro e3d.ReflectLinePV(L : LinePV, q : Multivector, n : Multivector) : LinePV
begin
    declare st : LinePV
    let st.P = ReflectPoint(L.P, q, n)
    let st.V = ReflectVector(L.V, n)
    return st
end

//Reflect a plane P into a plane with unit normal n and passing through 
//the point q
macro e3d.ReflectPlanePPP(P : PlanePPP, q : Multivector, n : Multivector) : PlanePPP
begin
    declare st : PlanePPP
    let st.P1 = ReflectPoint(P.P1, q, n)
    let st.P2 = ReflectPoint(P.P2, q, n)
    let st.P3 = ReflectPoint(P.P3, q, n)
    return st
end

//Reflect a plane P into a plane with unit normal n and passing through 
//the point q
macro e3d.ReflectPlanePN(P : PlanePN, q : Multivector, n : Multivector) : PlanePN
begin
    declare st : PlanePN
    let st.P = ReflectPoint(P.P, q, n)
    let st.N = ReflectVector(P.N, n)
    return st
end

//Perform a uniform scaling of the given frame F by a factor s relative to point q
macro e3d.UniformlyScaleFrame(F : Frame, q : Multivector, s : scalar) : Frame
begin
    declare st : Frame
    let st.O = UniformlyScalePoint(F.O, q, s)
    let st.X = UniformlyScaleVector(F.X, s)
    let st.Y = UniformlyScaleVector(F.Y, s)
    let st.Z = UniformlyScaleVector(F.Z, s)
    return st
end

//Perform a uniform scaling of the given line L by a factor s relative to point q
macro e3d.UniformlyScaleLinePP(L : LinePP, q : Multivector, s : scalar) : LinePP
begin
    declare st : LinePP
    let st.P1 = UniformlyScalePoint(L.P1, q, s)
    let st.P2 = UniformlyScalePoint(L.P2, q, s)
    return st
end

//Perform a uniform scaling of the given line L by a factor s relative to point q
macro e3d.UniformlyScaleLinePV(L : LinePV, q : Multivector, s : scalar) : LinePV
begin
    declare st : LinePV
    let st.P = UniformlyScalePoint(L.P, q, s)
    let st.V = UniformlyScaleVector(L.V, s)
    return st
end

//Perform a uniform scaling of the given plane P by a factor s relative to point q
macro e3d.UniformlyScalePlanePPP(P : PlanePPP, q : Multivector, s : scalar) : PlanePPP
begin
    declare st : PlanePPP
    let st.P1 = UniformlyScalePoint(P.P1, q, s)
    let st.P2 = UniformlyScalePoint(P.P2, q, s)
    let st.P3 = UniformlyScalePoint(P.P3, q, s)
    return st
end

//Perform a uniform scaling of the given plane P by a factor s relative to point q
macro e3d.UniformlyScalePlanePN(P : PlanePN, q : Multivector, s : scalar) : PlanePN
begin
    declare st : PlanePN
    let st.P = UniformlyScalePoint(P.P, q, s)
    let st.N = UniformlyScaleVector(P.N, s)
    return st
end

//Perform a directional scaling of the given frame F by factor s in the direction 
//of the unit vector u and relative to the point q
macro e3d.ScaleFrame(F : Frame, q : Multivector, u : Multivector, s : scalar) : Frame
begin
    declare st : Frame
    let st.O = ScalePoint(F.O, q, u, s)
    let st.X = ScaleVector(F.X, u, s)
    let st.Y = ScaleVector(F.Y, u, s)
    let st.Z = ScaleVector(F.Z, u, s)
    return st
end

//Perform a directional scaling of the given line L by factor s in the direction 
//of the unit vector u and relative to the point q
macro e3d.ScaleLinePP(L : LinePP, q : Multivector, u : Multivector, s : scalar) : LinePP
begin
    declare st : LinePP
    let st.P1 = ScalePoint(L.P1, q, u, s)
    let st.P2 = ScalePoint(L.P2, q, u, s)
    return st
end

//Perform a directional scaling of the given line L by factor s in the direction 
//of the unit vector u and relative to the point q
macro e3d.ScaleLinePV(L : LinePV, q : Multivector, u : Multivector, s : scalar) : LinePV
begin
    declare st : LinePV
    let st.P = ScalePoint(L.P, q, u, s)
    let st.V = ScaleVector(L.V, u, s)
    return st
end

//Perform a directional scaling of the given plane P by factor s in the direction 
//of the unit vector u and relative to the point q
macro e3d.ScalePlanePPP(P : PlanePPP, q : Multivector, u : Multivector, s : scalar) : PlanePPP
begin
    declare st : PlanePPP
    let st.P1 = ScalePoint(P.P1, q, u, s)
    let st.P2 = ScalePoint(P.P2, q, u, s)
    let st.P3 = ScalePoint(P.P3, q, u, s)
    return st
end

//Perform a directional scaling of the given plane P by factor s in the direction 
//of the unit vector u and relative to the point q
macro e3d.ScalePlanePN(P : PlanePN, q : Multivector, u : Multivector, s : scalar) : PlanePN
begin
    //Convert the given plane into the 3 points equivalent form, then apply the scaling, 
    //and finally convert back to the point-normal form
    //This operation is not generally numerically stable
    return PlanePPP2PlanePN(ScalePlanePPP(PlanePN2PlanePPP(P), q, u, s))
end</textarea></div>
			<div class="crayon-main" style=" max-height: 500px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-2">2</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-4">4</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-6">6</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-8">8</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-10">10</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-12">12</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-14">14</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-16">16</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-18">18</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-20">20</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-22">22</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-24">24</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-26">26</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-28">28</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-30">30</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-32">32</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-34">34</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-36">36</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-38">38</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-40">40</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-42">42</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-44">44</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-46">46</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-48">48</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-50">50</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-52">52</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-54">54</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-56">56</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-58">58</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-60">60</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-62">62</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-64">64</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-66">66</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-68">68</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-70">70</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-72">72</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-74">74</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-76">76</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-78">78</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-80">80</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-82">82</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-84">84</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-86">86</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-88">88</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-90">90</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-92">92</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-94">94</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-96">96</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-98">98</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-100">100</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-102">102</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-104">104</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-106">106</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-108">108</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-110">110</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-112">112</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-114">114</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-116">116</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-118">118</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-120">120</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-122">122</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-124">124</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-126">126</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-128">128</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-130">130</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-132">132</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-134">134</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-136">136</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-138">138</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-140">140</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-142">142</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-144">144</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-146">146</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-148">148</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-150">150</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-152">152</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-154">154</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-156">156</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-158">158</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-160">160</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-162">162</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-164">164</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-166">166</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-168">168</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-170">170</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-172">172</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-174">174</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-176">176</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-178">178</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-180">180</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-182">182</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-184">184</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-186">186</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-187">187</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-188">188</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-189">189</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-190">190</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-191">191</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-192">192</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-193">193</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-194">194</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-195">195</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-196">196</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-197">197</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-198">198</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-199">199</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-200">200</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-201">201</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-202">202</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-203">203</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-204">204</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-205">205</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-206">206</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-207">207</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-208">208</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-209">209</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-210">210</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-211">211</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-212">212</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-213">213</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-214">214</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-215">215</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-216">216</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-217">217</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-218">218</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-219">219</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-220">220</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-221">221</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-222">222</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-223">223</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-224">224</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-225">225</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-226">226</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-227">227</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-228">228</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-229">229</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-230">230</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-231">231</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-232">232</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-233">233</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-234">234</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-235">235</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-236">236</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-237">237</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-238">238</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-239">239</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-240">240</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-241">241</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-242">242</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-243">243</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-244">244</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-245">245</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-246">246</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-247">247</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-248">248</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-249">249</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-250">250</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-251">251</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-252">252</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-253">253</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-254">254</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-255">255</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-256">256</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-257">257</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-258">258</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-259">259</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-260">260</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-261">261</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-262">262</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-263">263</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-264">264</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-265">265</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-266">266</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-267">267</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-268">268</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-269">269</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-270">270</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-271">271</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-272">272</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-273">273</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-274">274</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-275">275</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-276">276</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-277">277</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-278">278</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-279">279</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-280">280</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-281">281</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-282">282</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-283">283</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-284">284</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-285">285</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-286">286</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-287">287</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-288">288</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-289">289</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-290">290</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-291">291</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-292">292</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-293">293</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-294">294</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-295">295</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-296">296</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-297">297</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-298">298</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-299">299</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-300">300</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-301">301</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-302">302</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-303">303</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-304">304</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-305">305</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-306">306</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-307">307</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-308">308</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-309">309</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-310">310</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-311">311</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-312">312</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-313">313</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-314">314</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-315">315</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-316">316</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-317">317</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-318">318</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-319">319</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-320">320</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-321">321</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-322">322</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-323">323</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-324">324</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-325">325</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-326">326</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-327">327</div><div class="crayon-num crayon-striped-num" data-line="crayon-59e4fc22a4b1f367987421-328">328</div><div class="crayon-num" data-line="crayon-59e4fc22a4b1f367987421-329">329</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-1"><span class="crayon-c">//Our main namespace</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-2"><span class="crayon-t">namespace</span><span class="crayon-h"> </span><span class="crayon-v">affine3d</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-4"><span class="crayon-c">//A frame in 3D consisting of an origin point and 3 linearly independent vectors. </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-5"><span class="crayon-c">//A frame with orthonormal vectors is the main model for a rigid body in many applications</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-6"><span class="crayon-e">structure </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">Frame</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-8"><span class="crayon-c">//1st Problem: The same geometric concept (line or plane) have many combinatorial representations.</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-9"><span class="crayon-c">//Each representation is suitable for a subset of our geometric manipulation algorithms.</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-10"><span class="crayon-c">//For each representation we store the generators of the concept (usually simpler geometric concepts)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-11"><span class="crayon-c">//such that we can construct the geometric concept from these generators using simple algebraic manipulation</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-12">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-13"><span class="crayon-c">//A line generated by two points</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-14"><span class="crayon-e">structure </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">LinePP</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-16"><span class="crayon-c">//A line generated by a point and a vector</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-17"><span class="crayon-e">structure </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">LinePV</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-18">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-19"><span class="crayon-c">//A plane generated by 3 points</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-20"><span class="crayon-e">structure </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">PlanePPP</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-22"><span class="crayon-c">//A plane generated by a point and a unit-normal</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-23"><span class="crayon-e">structure </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">PlanePN</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">N</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-24">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-25"><span class="crayon-c">//This macro adjusts the given frame to make sure its 3 vectors are orthonormal and right-handed</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-26"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">NormalizeFrame</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Frame</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-27"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-28"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-29"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-i">O</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UnitVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UnitVector</span><span class="crayon-sy">(</span><span class="crayon-e">RejectVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CrossProduct</span><span class="crayon-sy">(</span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-34"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-36"><span class="crayon-c">//2nd Problem: We need to convert between different representations of the same geometric concept.</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-37"><span class="crayon-c">//his is becaus each representation is only suitable for a subset of all geometric operations </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-38"><span class="crayon-c">//on the geometric concept. We usually apply several algorithms together so we need this intermediate </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-39"><span class="crayon-c">//conversion of representation often</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-40">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-41"><span class="crayon-c">//3rd Problem: Are there any other geometric operations that can be used to represent the same</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-42"><span class="crayon-c">//geometric concept? (A line can be geometrically represented by two planes as their intersection)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-43"><span class="crayon-c">//How can we enumerate all possible combinatorial represenatations?</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-44">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-45"><span class="crayon-c">//Convert a line in two-points form into the point-vector form</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-46"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">LinePP2LinePV</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePP</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-47"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-48"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-49"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-50">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-51"><span class="crayon-c">//Convert a line in point-vector form into the two-points form</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-52"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">LinePV2LinePP</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePV</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-53"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-54"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span><span class="crayon-sy">(</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-55"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-56">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-57"><span class="crayon-c">//Convert a plane in 3-points form into the point-normal form</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-58"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">PlanePPP2PlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePPP</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-59"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-60"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">N</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UnitCrossProduct</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-61"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-62">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-63"><span class="crayon-c">//Convert a plane in point-normal form into the 3-points form</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-64"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">PlanePN2PlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-65"><span class="crayon-v">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Assuming normal to plane P is almost parallel to z-axis; this is not numerically</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//stable if angle between plane normal and z-axis is near 90 degrees</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CrossProduct</span><span class="crayon-sy">(</span><span class="crayon-e">Multivector</span><span class="crayon-sy">(</span><span class="crayon-p">#e3# = 1), P.N)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CrossProduct</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-72"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-73">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-74"><span class="crayon-c">//4th Problem: Transforming geometric concepts must be specialized to each combinatorial representation</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-75">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-76"><span class="crayon-c">//Translate a frame F in the direction of vector v</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-77"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">TranslateFrame</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-78"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-79"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-80"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-i">X</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-i">Y</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-i">Z</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-85"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-86">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-87"><span class="crayon-c">//Translate a line L in the direction of vector v</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-88"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">TranslateLinePP</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-89"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-90"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-91"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-94"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-95">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-96"><span class="crayon-c">//Translate a line L in the direction of vector v</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-97"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">TranslateLinePV</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePV</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-98"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-99"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-100"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-i">V</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-103"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-104">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-105"><span class="crayon-c">//Translate a plane P in the direction of vector v</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-106"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">TranslatePlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePPP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-107"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-108"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-109"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-113"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-114">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-115"><span class="crayon-c">//Translate a plane P in the direction of vector v</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-116"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">TranslatePlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-117"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-118"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-119"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TranslatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-120"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-i">N</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-121"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-122"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-123">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-124"><span class="crayon-c">//Rotate the frame F around an axis passing through point q and having </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-125"><span class="crayon-c">//direction unit vector u with an angle a in radians</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-126"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotateFrame</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-127"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-128"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-129"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-130"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-131"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-134"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-135">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-136"><span class="crayon-c">//Rotate the line L around an axis passing through point q and having </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-137"><span class="crayon-c">//direction unit vector u with an angle a in radians</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-138"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotateLinePP</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-139"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-140"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-141"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-142"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-143"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-144"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-145">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-146"><span class="crayon-c">//Rotate the line L around an axis passing through point q and having </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-147"><span class="crayon-c">//direction unit vector u with an angle a in radians</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-148"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotateLinePV</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePV</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-149"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-150"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-151"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-152"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-153"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-154"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-155">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-156"><span class="crayon-c">//Rotate the plane P around an axis passing through point q and having </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-157"><span class="crayon-c">//direction unit vector u with an angle a in radians</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-158"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotatePlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePPP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-159"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-160"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-161"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-162"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-163"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-164"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-165"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-166">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-167"><span class="crayon-c">//Rotate the plane P around an axis passing through point q and having </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-168"><span class="crayon-c">//direction unit vector u with an angle a in radians</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-169"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">AxisRotatePlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-170"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-171"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-172"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotatePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-173"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AxisRotateVector</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-174"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-175"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-176">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-177"><span class="crayon-c">//Reflect a frame F into a plane with unit normal n and passing through </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-178"><span class="crayon-c">//the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-179"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectFrame</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-180"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-181"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-182"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-183"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-184"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-185"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-186"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-187"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-188">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-189"><span class="crayon-c">//Reflect a line L into a plane with unit normal n and passing through </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-190"><span class="crayon-c">//the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-191"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectLinePP</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-192"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-193"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-194"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-195"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-196"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-197"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-198">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-199"><span class="crayon-c">//Reflect a line L into a plane with unit normal n and passing through </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-200"><span class="crayon-c">//the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-201"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectLinePV</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePV</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-202"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-203"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-204"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-205"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-206"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-207"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-208">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-209"><span class="crayon-c">//Reflect a plane P into a plane with unit normal n and passing through </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-210"><span class="crayon-c">//the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-211"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectPlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePPP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-212"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-213"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-214"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-215"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-216"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-217"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-218"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-219">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-220"><span class="crayon-c">//Reflect a plane P into a plane with unit normal n and passing through </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-221"><span class="crayon-c">//the point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-222"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ReflectPlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-223"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-224"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-225"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectPoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-226"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ReflectVector</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-227"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-228"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-229">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-230"><span class="crayon-c">//Perform a uniform scaling of the given frame F by a factor s relative to point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-231"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScaleFrame</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-232"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-233"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-234"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-235"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-236"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-237"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-238"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-239"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-240">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-241"><span class="crayon-c">//Perform a uniform scaling of the given line L by a factor s relative to point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-242"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScaleLinePP</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-243"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-244"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-245"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-246"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-247"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-248"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-249">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-250"><span class="crayon-c">//Perform a uniform scaling of the given line L by a factor s relative to point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-251"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScaleLinePV</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePV</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-252"><span class="crayon-e">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-253"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-254"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-255"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-256"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-257"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-258">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-259"><span class="crayon-c">//Perform a uniform scaling of the given plane P by a factor s relative to point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-260"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScalePlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePPP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-261"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-262"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-263"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-264"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-265"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-266"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-267"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-268">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-269"><span class="crayon-c">//Perform a uniform scaling of the given plane P by a factor s relative to point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-270"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">UniformlyScalePlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-271"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-272"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-273"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-274"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">UniformlyScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">N</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-275"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-276"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-277">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-278"><span class="crayon-c">//Perform a directional scaling of the given frame F by factor s in the direction </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-279"><span class="crayon-c">//of the unit vector u and relative to the point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-280"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScaleFrame</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-281"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-282"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Frame</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-283"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">O</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-284"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-285"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-286"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-287"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-288"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-289">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-290"><span class="crayon-c">//Perform a directional scaling of the given line L by factor s in the direction </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-291"><span class="crayon-c">//of the unit vector u and relative to the point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-292"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScaleLinePP</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-293"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-294"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-295"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-296"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-297"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-298"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-299">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-300"><span class="crayon-c">//Perform a directional scaling of the given line L by factor s in the direction </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-301"><span class="crayon-c">//of the unit vector u and relative to the point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-302"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScaleLinePV</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">LinePV</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-303"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-304"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">LinePV</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-305"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-306"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScaleVector</span><span class="crayon-sy">(</span><span class="crayon-v">L</span><span class="crayon-sy">.</span><span class="crayon-v">V</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-307"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-308"><span class="crayon-v">end</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-309">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-310"><span class="crayon-c">//Perform a directional scaling of the given plane P by factor s in the direction </span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-311"><span class="crayon-c">//of the unit vector u and relative to the point q</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-312"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScalePlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePPP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-313"><span class="crayon-e">begin</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-314"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">declare </span><span class="crayon-v">st</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-315"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-316"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-317"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">let </span><span class="crayon-v">st</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ScalePoint</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">.</span><span class="crayon-v">P3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-318"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">st</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-319"><span class="crayon-v">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-320">&nbsp;</div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-321"><span class="crayon-c">//Perform a directional scaling of the given plane P by factor s in the direction </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-322"><span class="crayon-c">//of the unit vector u and relative to the point q</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-323"><span class="crayon-e">macro </span><span class="crayon-v">e3d</span><span class="crayon-sy">.</span><span class="crayon-e">ScalePlanePN</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">PlanePN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Multivector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">scalar</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PlanePN</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-324"><span class="crayon-v">begin</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-325"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Convert the given plane into the 3 points equivalent form, then apply the scaling, </span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-326"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//and finally convert back to the point-normal form</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-327"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//This operation is not generally numerically stable</span></div><div class="crayon-line crayon-striped-line" id="crayon-59e4fc22a4b1f367987421-328"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">PlanePPP2PlanePN</span><span class="crayon-sy">(</span><span class="crayon-e">ScalePlanePPP</span><span class="crayon-sy">(</span><span class="crayon-e">PlanePN2PlanePPP</span><span class="crayon-sy">(</span><span class="crayon-v">P</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59e4fc22a4b1f367987421-329"><span class="crayon-v">end</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0551 seconds] -->
<p>In code listing 2 we can immediately see why the 3D Euclidean Geometric Algebra is not suitable for dealing with affine transformations. We selected to implement 3 kinds of basic geometric concepts:</p>
<ol>
<li>A Frame consisting of an origin point and 3 vectors that are usually orthogonal to each other, of unit length, and make a right-handed coordinates system</li>
<li>An infinite Straight Line generated by two points or a point and a direction vector</li>
<li>An infinite Flat Plane generated by 3 points or a point and a normal vector</li>
</ol>
<p>The first thing we notice is that the same concept (for example a line) can be specified using several simpler concepts (2 points or a point plus a vector). We can call the set of simpler concepts &#8220;the generators&#8221; of our concept (the line). Any point on the line can be obtained using its generators using some sort of algebraic manipulations specific to our concept. This fundamental geometric representation reality results in the following problems, not related to our programming language, but rather to the underlying algebra:</p>
<ul>
<li><strong>Problem 1:</strong> There are many sets of generators for a single main geometric concept. Each set can be useful for some geometric manipulations of the main geometric concept. For example, a plane (the main geometric concept) can be generated using 3 non-colinear points, one point and a normal vector, two points and a vector, one point and two non-parallel vectors, two intersecting lines, a point and a line not passing through it, etc. Some tasks on the plane would be easier to perform using its 3-points form, but harder or not possible using its point and normal form</li>
<li><strong>Problem 2:</strong> If we select a number of generator sets for some main concept, we must write code to convert these generator sets to each other. As in code listing 2, we must convert between the 2-points representation of a line and the point-vector representation. This conversion is required when several tasks are to be performed on the main geometric concept, while not all being applicable using a single set of generators. The conversion code must be written very carefully to ensure efficiency and numerical stability.</li>
<li><strong>Problem 3:</strong> Related to the previous two problems is the question of enumerating all generator sets of the main geometric concept. How many ways can we generate a line using other geometric concepts? Which geometric manipulations are easier, more efficient, or numerically stable for each generator set?</li>
<li><strong>Problem 4:</strong> If we have a geometric manipulation task that is possible on <em>m</em> generator sets of some main geometric concept, then we should implement <em>m</em> subroutines to fully realize the geometric manipulation task on all sets of generators. This is a problematic situation when there are a large number of representations for a main geometric concept.</li>
</ul>
<p>To reduce the severity of these 4 problems we need to find an algebra that has the following properties:</p>
<ul>
<li>The basic elements of the selected algebra should be able to represent as many geometric concepts as possible to reduce the need for combinatorial representations. In our 3D Euclidean GA, we have selected to limit its efficiency by dealing wth vectors and scalars while ignoring its bivectors and pseudo-scalar components. This is why this method results in an explosion in required code that will be mostly written by hand. We can try to search for a better Geometric Algebra that can directly represent lines and planes using its multivectors without the need for combinatorial structures of more basic elements.</li>
<li>The main geometric tasks should be performed using compact algebraic operations on the elements of the algebra. For example, when the rotation equation is large and difficult to write for each geometric concept, the amount of manual code will be large and error-prone. A better GA should be able to represent as many geometric transformations as possible, each using a single outermorphism or, better, a versor product.</li>
</ul>
<p>These two requirements on the algebra can be effectively satisfied by selecting other Geometric Algebras for our problem like the 4D homogenous GA or, better, the 5D Conformal GA. The larger-dimension GAs are generally better from the algebraic point of view but will have other computational problems associated with them. That&#8217;s a topic for another discussion when we see how GMacAPI can be used to solve the computational problems of larger GAs.</p>
<h3>Using Outermophisms</h3>
<p>As we can see from the previous code listings, using a small space like the 3D Euclidean GA to represent 3D geometry is very limiting. Many significant geometric objects, like lines, planes, spheres, etc. can&#8217;t be directly represented as multivectors; we must use combinatorial representations (i.e. data structures) with all their problems.  In addition, the basic transformations are not linear in that space; we can&#8217;t use 3&#215;3 matrices, GA outermorphisms, or versors of the 3D Euclidean space for many important geometric transformations like translations and shearing. A better solution is to use a higher dimensional space like the 4D Homogeneous GA for our geometric models. In the 4D Homogeneous GA lines and planes can be represented as multivectors. Also, compositions of translations, rotations, and scalings are outermorphisms in this space. For this code to work, we will need <em><strong>GMac Basic</strong></em> or <em><strong>GMac Complete</strong></em>.</p>
<p style="text-align: center;"><strong>Code Listing 3</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
      <nav class="pagination group">
              </nav><!--/.pagination-->
      <div class="clear"></div>
    </div><!--/.entry-->

  </article>

  
          </div><!--/.pad-->
        </section><!--/.content-->
          

        </div><!--/.main-inner-->
      </div><!--/.main-->
    </div><!--/.container-inner-->
  </div><!--/.container-->
    <footer id="footer">

    
    
        <section class="container" id="footer-widgets">
          <div class="container-inner">

            <div class="pad group">

                                <div class="footer-widget-1 grid one-full last">
                    <div id="media_image-2" class="widget widget_media_image"><img width="1380" height="138" src="https://gmac-guides.netlify.com/wp-content/uploads/2017/02/GA-Explorer-Footer-v2.jpg" class="image wp-image-2454  attachment-full size-full" alt="GA-Explorer-Footer-v2" style="max-width: 100%; height: auto;" srcset="https://gmac-guides.netlify.com/wp-content/uploads/2017/02/GA-Explorer-Footer-v2.jpg 1380w, https://gmac-guides.netlify.com/wp-content/uploads/2017/02/GA-Explorer-Footer-v2-300x30.jpg 300w, https://gmac-guides.netlify.com/wp-content/uploads/2017/02/GA-Explorer-Footer-v2-768x77.jpg 768w, https://gmac-guides.netlify.com/wp-content/uploads/2017/02/GA-Explorer-Footer-v2-1024x102.jpg 1024w" sizes="(max-width: 1380px) 100vw, 1380px" /></div>                  </div>
              
            </div><!--/.pad-->

          </div><!--/.container-inner-->
        </section><!--/.container-->

    
    
    <section class="container" id="footer-bottom">
      <div class="container-inner">

        <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>

        <div class="pad group">

          <div class="grid one-half">
                        
            <div id="copyright">
                              <p>GMac Guides &copy; 2017. All Rights Reserved.</p>
                          </div><!--/#copyright-->

                                                          <div id="credit" style="">
                    <p>Powered by&nbsp;<a class="fa fa-wordpress" title="Powered by WordPress" href="https://wordpress.org/" target="_blank"></a> - Designed with the&nbsp;<a href="https://presscustomizr.com/hueman/" title="Hueman theme">Hueman theme</a></p>
                  </div><!--/#credit-->
                          
          </div>

          <div class="grid one-half last">
                                                  </div>

        </div><!--/.pad-->

      </div><!--/.container-inner-->
    </section><!--/.container-->

  </footer><!--/#footer-->

</div><!--/#wrapper-->

<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-content/plugins/hueman-addons/addons/assets/front/js/jQuerySharrre.min.js?ver=4.8.2'></script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-includes/js/underscore.min.js?ver=1.8.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var HUParams = {"_disabled":[],"SmoothScroll":{"Enabled":true,"Options":{"touchpadSupport":false}},"centerAllImg":"1","timerOnScrollAllBrowsers":"1","extLinksStyle":"","extLinksTargetExt":"","extLinksSkipSelectors":{"classes":["btn","button"],"ids":[]},"imgSmartLoadEnabled":"","imgSmartLoadOpts":{"parentSelectors":[".container .content",".container .sidebar","#footer","#header-widgets"],"opts":{"excludeImg":[".tc-holder-img"],"fadeIn_options":100}},"goldenRatio":"1.618","gridGoldenRatioLimit":"350","sbStickyUserSettings":{"desktop":false,"mobile":false},"isWPMobile":"","menuStickyUserSettings":{"desktop":"stick_up","mobile":"stick_up"},"isDevMode":"","ajaxUrl":"http:\/\/gmac-guides.netlify.com\/?huajax=1","frontNonce":{"id":"HuFrontNonce","handle":"b32143a74e"},"userStarted":{"with":"with|3.3.21","on":{"date":"2017-10-12 21:00:09.000000","timezone_type":3,"timezone":"UTC"}},"isWelcomeNoteOn":"","welcomeContent":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-content/themes/hueman/assets/front/js/scripts.min.js?ver=3.3.22'></script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-includes/js/hoverIntent.min.js?ver=1.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var megamenu = {"timeout":"300","interval":"100"};
/* ]]> */
</script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-content/plugins/megamenu/js/maxmegamenu.js?ver=2.3.8'></script>
<script type='text/javascript' src='https://gmac-guides.netlify.com/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
<!--[if lt IE 9]>
<script src="https://gmac-guides.netlify.com/wp-content/themes/hueman/assets/front/js/ie/respond.js"></script>
<![endif]-->
<div id="turnkey-credit"> <div style="clear: both;"> <a href="https://www.turnkeylinux.org/wordpress">WordPress Appliance</a> - Powered by <a href="https://www.turnkeylinux.org">TurnKey Linux</a> </div> </div></body>
</html>